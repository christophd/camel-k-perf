# Camel K Performance Tests

This repository contains script to setup performance tests for Camel K 
for the Red Hat OpenShift Dev Sandbox environment.

In particular, the scripts focus on generating specific load profiles that
may affect the overall performance of the operator.

Collecting metrics is outside the scope of the scripts.

## Requirements

### 1. Checkout toolchain-e2e

The scripts in this repository assume that the `camel-k-perf` repository is checked out in the same directory
as the [toolchain-e2e](https://github.com/codeready-toolchain/toolchain-e2e).

I.e. from the root of this repository, the following command should return with no errors:

```
ls ../toolchain-e2e
```

### 2. Install test environment

Follow the instructions on the [toolchain-e2e setup guide](https://github.com/codeready-toolchain/toolchain-e2e/tree/master/setup)
to install a test dev sandbox environment on a cluster, up to the point of populating the cluster with users.

Actual population will be done with the scripts in this repository.

### 3. Install Camel K

Install the Camel K operator under test. The operator needs to be installed **globally** in the cluster.

Refer to the [upstream Camel K installation guide](https://camel.apache.org/camel-k/next/installation/installation.html) or
to the Red Hat documentation if you want to test the product version.

## Running Tests

Pick your test from the `scripts` directory and launch it from a shell.

Current scripts include:

- `01-look-there-a-camel.sh`: Wanting to be optimistic, 10% of active dev sandbox users will be using Camel K. Here we test that the operator does not interfere with othersâ€™ workloads.
- `02-suddenly-love-for-camel.sh`: When a lot of people fall in love with Camel, they try the hello world altogether. We want to ensure that the time to get an integration ready is adequate.
- `03-the-summit-live-workshop.sh`: This is a variation of scenario 2 where all people hit the button to create the integration in the same exact moment.
- `04-good-cameleers-share-builds.sh`: Assuming 5% of the integrations generated by the users are going to create a build, we measure how the builds are serialized and the shape of users' wait times.
- `05-the-bad-workshop.sh`: Workshop instructions tell the users to create an integration platform in their namespaces. This leads to parallel builds executed in the same moment.
